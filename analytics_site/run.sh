#!/bin/bash
# éƒ¨ç½²è„šæœ¬ - ç¬¦åˆ yunguhs.com æ•™ç¨‹æ ‡å‡†

# 1. ç¡®ä¿åœ¨è„šæœ¬æ‰€åœ¨ç›®å½•
cd "$(dirname "$0")"

echo "-----------------------------------"
echo "ğŸš€ å¼€å§‹éƒ¨ç½² Analytics Site..."
echo "-----------------------------------"

# 2. å®‰è£…ä¾èµ– (ä½¿ç”¨ --user é¿å…æƒé™é—®é¢˜)
echo "ğŸ“¦ æ­£åœ¨å®‰è£…ä¾èµ–..."
pip3 install --user -r requirements.txt

# 3. å¯åŠ¨æœåŠ¡
# ä½¿ç”¨ python3 -m uvicorn ç¡®ä¿èƒ½æ‰¾åˆ°å‘½ä»¤
# host 0.0.0.0 å…è®¸å…¬ç½‘è®¿é—®
# port 5270 æ˜¯ä½ æŒ‡å®šçš„ç«¯å£
echo "-----------------------------------"
echo "âœ… æœåŠ¡å¯åŠ¨ä¸­..."
echo "ğŸŒ è®¿é—®åœ°å€: http://110.40.153.38:5270/"
echo "-----------------------------------"

# æ£€æŸ¥ç«¯å£å ç”¨å¹¶æ¸…ç†ï¼ˆå¯é€‰ï¼Œé˜²æ­¢ç«¯å£å†²çªï¼‰
fuser -k 5270/tcp >/dev/null 2>&1

# å¯åŠ¨
python3 -m uvicorn main:app --host 0.0.0.0 --port 5270
